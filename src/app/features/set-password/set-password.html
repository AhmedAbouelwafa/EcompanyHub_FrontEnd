<div class="token-verification">
  <!-- Animated Background -->
  <div class="token-verification__background">
    <div class="token-verification__floating-shapes">
      <div class="token-verification__shape token-verification__shape--1"></div>
      <div class="token-verification__shape token-verification__shape--2"></div>
      <div class="token-verification__shape token-verification__shape--3"></div>
      <div class="token-verification__shape token-verification__shape--4"></div>
      <div class="token-verification__shape token-verification__shape--5"></div>
    </div>
  </div>

  <div class="token-verification__wrapper">
    <div class="token-verification__card">
      <div class="token-verification__card-inner">
        <!-- Header with Icon -->
        <div class="token-verification__header">
          <div class="token-verification__icon-wrapper">
            <i class="fas fa-key token-verification__icon" aria-hidden="true"></i>
          </div>
          <h1 class="token-verification__title">تعيين كلمة المرور</h1>
          <p class="token-verification__subtitle">
            أدخل كلمة المرور الجديدة مرتين للتحقق
          </p>
        </div>

        <!-- Password Form -->
        <form [formGroup]="passwordForm" (ngSubmit)="submit()" class="token-verification__form" role="form">
          <!-- Password -->
          <div class="token-verification__form-group">
            <label for="password" class="token-verification__label">
              <i class="fas fa-lock token-verification__label-icon" aria-hidden="true"></i>
              كلمة المرور
            </label>
            <div class="token-verification__input-wrapper">
              <input
                id="password"
                [type]="showPassword ? 'text' : 'password'"
                class="token-verification__input"
                formControlName="password"
                placeholder="أدخل كلمة المرور"
                [class.token-verification__input--error]="password?.touched && password?.errors"
                aria-describedby="password-error"
                autocomplete="new-password" />
              <button
                type="button"
                class="token-verification__toggle-password"
                (click)="togglePasswordVisibility()"
                aria-label="إظهار/إخفاء كلمة المرور">
                <i class="fas" [ngClass]="showPassword ? 'fa-eye-slash' : 'fa-eye'" aria-hidden="true"></i>
              </button>
              <div class="token-verification__input-focus-border"></div>
            </div>

            <div id="password-error" *ngIf="password?.touched && password?.errors" role="alert">
              <div class="token-verification__error" *ngIf="password?.errors?.['required']">
                <i class="fas fa-exclamation-circle token-verification__error-icon" aria-hidden="true"></i>
                كلمة المرور مطلوبة
              </div>
              <div class="token-verification__error" *ngIf="password?.errors?.['minlength']">
                <i class="fas fa-exclamation-circle token-verification__error-icon" aria-hidden="true"></i>
                يجب أن تكون كلمة المرور 8 أحرف على الأقل
              </div>
              <div class="token-verification__error" *ngIf="password?.errors?.['pattern']">
                <i class="fas fa-exclamation-circle token-verification__error-icon" aria-hidden="true"></i>
                يجب أن تحتوي كلمة المرور على حرف كبير، رقم، وحرف خاص
              </div>
            </div>
          </div>

          <!-- Confirm Password -->
          <div class="token-verification__form-group">
            <label for="confirmPassword" class="token-verification__label">
              <i class="fas fa-lock token-verification__label-icon" aria-hidden="true"></i>
              تأكيد كلمة المرور
            </label>
            <div class="token-verification__input-wrapper">
              <input
                id="confirmPassword"
                [type]="showConfirmPassword ? 'text' : 'password'"
                class="token-verification__input"
                formControlName="confirmPassword"
                placeholder="أعد إدخال كلمة المرور"
                [class.token-verification__input--error]="confirmPassword?.touched && confirmPassword?.errors"
                aria-describedby="confirmPassword-error"
                autocomplete="new-password" />
              <button
                type="button"
                class="token-verification__toggle-password"
                (click)="toggleConfirmPasswordVisibility()"
                aria-label="إظهار/إخفاء تأكيد كلمة المرور">
                <i class="fas" [ngClass]="showConfirmPassword ? 'fa-eye-slash' : 'fa-eye'" aria-hidden="true"></i>
              </button>
              <div class="token-verification__input-focus-border"></div>
            </div>

            <div id="confirmPassword-error" *ngIf="confirmPassword?.touched && confirmPassword?.errors" role="alert">
              <div class="token-verification__error" *ngIf="confirmPassword?.errors?.['required']">
                <i class="fas fa-exclamation-circle token-verification__error-icon" aria-hidden="true"></i>
                تأكيد كلمة المرور مطلوب
              </div>
              <div class="token-verification__error" *ngIf="confirmPassword?.errors?.['passwordMismatch']">
                <i class="fas fa-exclamation-circle token-verification__error-icon" aria-hidden="true"></i>
                كلمة المرور غير متطابقة
              </div>
            </div>
          </div>

          <!-- Submit Button -->
          <div class="token-verification__form-group">
            <button
              type="submit"
              class="token-verification__submit"
              [disabled]="passwordForm.invalid || isLoading"
              [class.token-verification__submit--loading]="isLoading"
              aria-label="تأكيد كلمة المرور">
              <span *ngIf="isLoading" class="token-verification__spinner"></span>
              <i *ngIf="!isLoading" class="fas fa-check token-verification__submit-icon" aria-hidden="true"></i>
              {{ isLoading ? 'جاري التحقق...' : 'تأكيد كلمة المرور' }}
            </button>
          </div>
        </form>

        <!-- Success Message -->
        <div class="token-verification__success" *ngIf="showSuccess" role="alert">
          <i class="fas fa-check-circle token-verification__success-icon" aria-hidden="true"></i>
          <span class="token-verification__success-text">{{ successMessage }}</span>
        </div>

        <!-- Error Message -->
        <div class="token-verification__error" *ngIf="errorMsg" role="alert">
          <i class="fas fa-exclamation-circle token-verification__error-icon" aria-hidden="true"></i>
          <span class="token-verification__error-text">{{ errorMsg }}</span>
        </div>
      </div>
    </div>
  </div>
</div>
